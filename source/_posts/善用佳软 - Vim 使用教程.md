---
title: 善用佳软 - Vim 使用教程
categories:
  - 工具软件
tags:
  - Vim
abbrlink: '436448e4'
date: 2020-11-26 16:03:54
---
Vim 是从 vi 发展出来的一个文本编辑器，在程序员中被广泛使用。和 Emacs 并列成为类 Unix 系统用户最喜欢的编辑器。

<!--more-->

## Vim 模式介绍

Vim 具有 6 种基本模式和 5 种派生模式，我们这里只简单介绍下 6 种基本模式：

- 普通模式 (Normal mode)

在普通模式中，用的编辑器命令，比如移动光标，删除文本等等。这也是 Vim 启动后的默认模式。这正好和许多新用户期待的操作方式相反（大多数编辑器默认模式为插入模式）。

- 插入模式 (Insert mode)

在这个模式中，大多数按键都会向文本缓冲中插入文本。大多数新用户希望文本编辑器编辑过程中一直保持这个模式。

> 在插入模式中，可以按 ESC 键回到普通模式。

- 可视模式 (Visual mode)

> 这个模式与普通模式比较相似。但是移动命令会扩大高亮的文本区域。高亮区域可以是字符、行或者是一块文本。当执行一个非移动命令时，命令会被执行到这块高亮的区域上。Vim 的 "文本对象" 也能和移动命令一样用在这个模式中。

- 选择模式 (Select mode)

> 这个模式和无模式编辑器的行为比较相似（Windows 标准文本控件的方式）。这个模式中，可以用鼠标或者光标键高亮选择文本，不过输入任何字符的话，Vim 会用这个字符替换选择的高亮文本块，并且自动进入插入模式。

- 命令行模式 (Command line mode)

> 在命令行模式中可以输入会被解释成并执行的文本。例如执行命令（: 键），搜索（/ 和? 键）或者过滤命令（! 键）。在命令执行之后，Vim 返回到命令行模式之前的模式，通常是普通模式。

- Ex 模式 (Ex mode)

这和命令行模式比较相似，在使用 :visual 命令离开 Ex 模式前，可以一次执行多条命令。

> 这其中我们常用到就是普通模式、插入模式和命令行模式，本课程也只涉及这三个常用模式的内容

## 三种常用模式的切换

vim 启动进入普通模式，处于插入模式或命令行模式时只需要按 Esc 或者 Ctrl+[（这在 vim 课程环境中不管用）即可进入普通模式。普通模式中按 i（插入）或 a（附加）键都可以进入插入模式，普通模式中按 : 进入命令行模式。命令行模式中输入 wq 回车后保存并退出 vim。

## 基础操作

### 游标移动

普通模式，在该模式下使用方向键或者 h，j，k，l 键可以移动游标。

| 按键 | 说明 |
|- | - |
| h | 左 |
| l | 右（小写 L） |
| j | 下 |
| k | 上 |
| w | 移动到下一个单词 |
| b | 移动到上一个单词 |

### 进入插入模式

在普通模式下使用下面的键将进入插入模式，并可以从相应的位置开始输入

| 命令 | 说明 |
|- | - |
| i | 在当前光标处进行编辑 |
| I | 在行首插入 |
| A | 在行末插入 |
| a | 在光标后插入编辑 |
| o | 在当前行后插入一个新行 |
| O | 在当前行前插入一个新行 |
| cw | 替换从光标所在位置后到一个单词结尾的字符 |

### 保存文档

从普通模式输入 : 进入命令行模式，输入 w 回车，保存文档。输入 :w <filename> 可以将文档另存为其他文件名或存到其它路径下。

### 退出 vim

| 命令 | 说明 |
|- | - |
| :q! | 强制退出，不保存 |
| :q | 退出 |
| :wq! | 强制保存并退出 |
| :w <filename> | 另存为 |
| :saveas 文件路径 | 另存为 |
| :x | 保存并退出 |
| :wq | 保存并退出 |

普通模式下按下 Shift+zz 即可保存退出 vim。

### 删除文本

| 命令 | 说明 |
|- | - |
| x | 删除游标所在的字符 |
| X | 删除游标所在前一个字符 |
| Delete | 同 x |
| dd | 删除整行 |
| dw | 删除一个单词（不适用中文） |
| d$ 或 D | 删除至行尾 |
| d^ | 删除至行首 |
| dG | 删除到文档结尾处 |
| d1G | 删至文档首部  |

除此之外，你还可以在命令之前加上数字，表示一次删除多行，如：2dd 表示一次删除 2 行。

## 入门操作

### 游标的快速跳转

#### 行间跳转

| 命令 | 说明 |
| - | - |
nG(n Shift+g) | 游标移动到第 n 行 (如果默认没有显示行号，请先进入命令模式，输入 :set nu 以显示行号)
gg | 游标移动到到第一行
G(Shift+g) | 到最后一行

> 小技巧：你在完成依次跳转后，可以使用 Ctrl+o 快速回到上一次 (跳转前) 光标所在位置。

#### 行内跳转

普通模式下使用下列命令在行内按照单词为单位进行跳转：

| 命令 | 说明 |
| - | - |
| w | 到下一个单词的开头 |
| e | 到当前单词的结尾 |
| b | 到前一个单词的开头 |
| ge | 到前一个单词的结尾 |
| 0 或 ^ | 到行头 |
| $ | 到行尾 |
| f <字母> | 向后搜索 < 字母 > 并跳转到第一个匹配的位置 (非常实用) |
| F <字母> | 向前搜索 < 字母 > 并跳转到第一个匹配的位置 |
| t <字母> | 向后搜索 < 字母 > 并跳转到第一个匹配位置之前的一个字母 (不常用) |
| T <字母> | 向前搜索 < 字母 > 并跳转到第一个匹配位置之后的一个字母 (不常用) |

### 复制粘贴和剪切

#### 复制及粘贴文本

普通模式中使用 y 复制：

| 命令 | 说明 |
| - | - |
| yy | 复制游标所在的整行（3yy 表示复制 3 行） |
| y^ | 复制至行首，或 y0。不含光标所在处字符 |
| y$ | 复制至行尾。含光标所在处字符 |
| yw | 复制一个单词 |
| y2w | 复制两个单词 |
| yG | 复制至文本末 |
| y1G | 复制至文本开头 |

普通模式中使用 p 粘贴：

| 命令 | 说明 |
| - | - |
| p | 粘贴至光标后（下） |
| P | 粘贴至光标前（上） |

#### 剪切及粘贴

其实前面讲得 dd 删除命令就是剪切，你每次 dd 删除文档内容后，便可以使用 p 来粘贴，也这一点可以让我们实现一个很爽快的功能——交换上下行。

ddp，就这么简单，即实现了快速交换光标所在行与它下面的行。

## 进阶操作

### 替换和撤销命令

替换和撤销命令都是针对普通模式下的操作：

| 命令 | 说明 |
| - | - |
| r+<待替换字母> | 将游标所在字母替换为指定字母 |
| R | 连续替换，直到按下 Esc |
| cc | 替换整行，即删除游标所在行，并进入插入模式 |
| cw | 替换一个单词，即删除一个单词，并进入插入模式 |
| C(大写) | 替换游标以后至行末 |
| ~ | 反转游标所在字母大小写 |
| u{n} | 撤销一次或 n 次操作 |
| U(大写) | 撤销当前行的所有修改 |
| Ctrl+r | redo，即撤销 undo 的操作 |

### 快速缩进

#### 调整缩进

- 普通模式下输入 >> 整行将向右缩进（使用，用于格式化代码超爽）
- 普通模式下输入 << 整行向左回退
- 普通模式下输入 : 进入命令行模式下对 `shiftwidth` 值进行设置可以控制缩进和回退的字符数
    - 获取目前的设定值 `:set shiftwidth?`
    - 设置缩进为 10 个字符 `:set shiftwidth=10`

#### 调整文本位置

- 命令行模式下输入 :ce(center) 命令使本行内容居中：
- 命令行模式下输入 :ri(right) 命令使本行文本靠右：
- 命令行模式下输入 le(left) 命令使本行内容靠左：

### 查找

#### 快速查找

普通模式下输入 / 然后键入需要查找的字符串，按回车后就会进行查找。? 与 / 功能相同，只不过 ? 是向上而 / 是向下查找。

进入查找之后，输入 n 和 N 可以继续查找。n 是查找下一个内容，N 查找上一个内容。

#### 高级查找

- 普通模式下输入 \* 寻找游标所在处的单词
- 普通模式下输入 \# 同上，但 \# 是向前（上）找，\* 则是向后（下）找
- 普通模式下输入 g\* 同 \*，但部分符合该单词即可
- 普通模式下输入 g\# 同 \#，但部分符合该单词即可

以上查找 n，N 的继续查找命令依然可以用。

## 高级操作

### 视窗操作

| 模式 | 命令 | 说明 |
| - | - | - |
| 命令行模式 | :sp 1.txt | 打开新的水平分屏视窗来编辑 1.txt |
| 命令行模式 | :vsp 2.txt | 打开新的垂直分屏视窗来编辑 2.txt |
| 普通模式 | Ctrl+w s | 将当前窗口分割成两个水平的窗口 |
| 普通模式 | Ctrl+w v | 将当前窗口分割成两个垂直的窗口 |
| 普通模式 | Ctrl+w q | 即 :q 结束分割出来的视窗。如果在新视窗中有输入需要使用强制符！即:q! |
| 普通模式 | Ctrl+w o | 打开一个视窗并且隐藏之前的所有视窗 |
| 普通模式 | Ctrl+w j | 移至下面视窗 |
| 普通模式 | Ctrl+w k | 移至上面视窗 |
| 普通模式 | Ctrl+w h | 移至左边视窗 |
| 普通模式 | Ctrl+w l | 移至右边视窗 |
| 普通模式 | Ctrl+w J | 将当前视窗移至下面 |
| 普通模式 | Ctrl+w K | 将当前视窗移至上面 |
| 普通模式 | Ctrl+w H | 将当前视窗移至左边 |
| 普通模式 | Ctrl+w L | 将当前视窗移至右边 |
| 普通模式 | Ctrl+w - | 减小视窗的高度 |
| 普通模式 | Ctrl+w + | 增加视窗的高度 |

### 文档加密

``` bash
# 创建加密文档
vim -x filename
```

输入您的密码，确认密码，这样在下一次打开时，vim 就会要求你输入密码。

### 在 vim 执行外部命令

在命令行模式中输入 ! 可以执行外部的 shell 命令，如：

- :!ls 用于显示当前目录的内容
- :!rm filename 用于删除名为 filename 的文件
- :w filename 可将当前 vim 中正在编辑的文件另存为 filename 文件

### 帮助系统

- 普通模式下按 F1 打开 vim 自己预设的帮助文档
- 命令行模式下输入 :h shiftwidth 打开名为 shiftwidth 的帮助文件
- 命令行模式下输入 :ver 显示版本及参数

## 参考资料

* [1] [Vim 基础入门 - 蓝桥](https://www.lanqiao.cn/courses/2)
